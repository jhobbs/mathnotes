/* Modern theme system using CSS custom properties and modern color spaces */
:root {
  /* ===== CORE COLOR PALETTE ===== */
  /* Base colors - everything else derives from these */
  
  /* Brand colors */
  --base-primary: oklch(64% 0.20 252);      /* Blue */
  --base-accent: oklch(70% 0.2 30);         /* Orange accent */
  
  /* Semantic colors */
  --base-error: oklch(53% 0.24 29);         /* Red */
  --base-success: oklch(55% 0.13 150);      /* Green */
  --base-warning: oklch(63% 0.20 40);       /* Yellow/Orange */
  --base-info: oklch(64% 0.04 220);         /* Light blue */
  
  /* Math content type colors */
  --base-math-definition: oklch(56% 0.13 252);    /* Blue */
  --base-math-theorem: oklch(60% 0.15 142);       /* Green */
  --base-math-proof: oklch(40% 0.05 250);         /* Dark blue */
  --base-math-example: oklch(55% 0.13 150);       /* Green */
  --base-math-note: oklch(50% 0.06 250);          /* Muted blue */
  
  /* Neutrals for light mode */
  --base-neutral-0: oklch(100% 0 0);        /* Pure white */
  --base-neutral-100: oklch(98% 0.01 100);  /* Off-white */
  --base-neutral-200: oklch(96% 0.01 100);  /* Light gray */
  --base-neutral-300: oklch(91% 0.01 210);  /* Gray */
  --base-neutral-700: oklch(52% 0.03 210);  /* Dark gray */
  --base-neutral-800: oklch(26% 0.02 100);  /* Near black */
  --base-neutral-900: oklch(0% 0 0);        /* Pure black */
  
  /* ===== DERIVED COLORS ===== */
  /* All other colors are calculated from the base palette */
  
  /* Primary variations */
  --color-primary: var(--base-primary);
  --color-primary-light: color-mix(in oklch, var(--base-primary) 10%, transparent);
  --color-primary-dark: oklch(52% 0.22 252);
  --color-primary-hover: color-mix(in oklch, var(--base-primary) 10%, transparent);
  --color-primary-active: color-mix(in oklch, var(--base-primary) 20%, transparent);
  
  /* Accent */
  --color-accent: var(--base-accent);
  
  /* Background colors */
  --color-bg: var(--base-neutral-100);
  --color-bg-secondary: var(--base-neutral-0);
  --color-card-bg: var(--base-neutral-0);
  --color-code-bg: oklch(97% 0.01 210);
  
  /* Text colors */
  --color-text: var(--base-neutral-800);
  --color-text-secondary: var(--base-neutral-700);
  --color-heading: var(--base-neutral-800);
  
  /* Interactive elements */
  --color-link: var(--color-primary);
  --color-link-hover: oklch(58% 0.22 252);
  --color-button-bg: var(--base-neutral-200);
  --color-button-hover: var(--base-neutral-300);
  --color-button-text: var(--base-neutral-800);
  
  /* Borders */
  --color-border: var(--base-neutral-300);
  --color-border-light: oklch(94% 0.01 100);
  
  /* State colors */
  --color-error: var(--base-error);
  --color-error-bg: oklch(95% 0.09 25);
  --color-error-border: var(--base-error);
  --color-error-text-dark: oklch(35% 0.15 29);
  --color-info-bg: color-mix(in oklch, var(--base-info) 15%, var(--color-bg));
  
  /* Overlays - all derived from black/white with alpha */
  --color-overlay-light: color-mix(in oklch, var(--base-neutral-900) 2%, transparent);
  --color-overlay-medium: color-mix(in oklch, var(--base-neutral-900) 5%, transparent);
  --color-overlay-dark: color-mix(in oklch, var(--base-neutral-900) 10%, transparent);
  --color-spinner-border: color-mix(in oklch, var(--base-neutral-900) 10%, transparent);
  
  /* Tooltip colors */
  --color-tooltip-bg: var(--base-neutral-0);
  --color-tooltip-footer-bg: var(--base-neutral-100);
  
  /* Math block colors - using base colors directly */
  --color-definition: var(--base-math-definition);
  --color-theorem: var(--base-math-theorem);
  --color-lemma: oklch(58% 0.14 241);
  --color-proposition: oklch(62% 0.12 230);
  --color-corollary: oklch(54% 0.08 250);
  --color-proof: var(--base-math-proof);
  --color-example: var(--base-math-example);
  --color-remark: var(--base-math-note);
  --color-note: var(--base-math-note);
  --color-intuition: oklch(65% 0.12 180);
  --color-exercise: var(--base-math-definition);
  --color-solution: var(--base-math-note);
  
  /* Math tooltip type colors - reuse base colors where appropriate */
  --color-type-definition: oklch(60% 0.17 252);
  --color-type-theorem: var(--base-error);
  --color-type-proposition: oklch(55% 0.18 300);
  --color-type-lemma: var(--base-warning);
  --color-type-corollary: oklch(50% 0.15 142);
  --color-type-example: oklch(52% 0.12 85);
  --color-type-note: oklch(48% 0.06 250);
  
  /* Nested math block overlays - all using color-mix for consistency */
  --color-nested-definition: color-mix(in oklch, var(--color-definition) 3%, transparent);
  --color-nested-theorem: color-mix(in oklch, var(--color-theorem) 3%, transparent);
  --color-nested-lemma: color-mix(in oklch, var(--color-lemma) 3%, transparent);
  --color-nested-proposition: color-mix(in oklch, var(--color-proposition) 3%, transparent);
  --color-nested-corollary: color-mix(in oklch, var(--color-corollary) 2.5%, transparent);
  --color-nested-proof: color-mix(in oklch, var(--color-proof) 3%, transparent);
  --color-nested-example: color-mix(in oklch, var(--color-example) 3%, transparent);
  
  /* Embedded block overlays */
  --color-embedded-bg: color-mix(in oklch, var(--base-neutral-900) 3%, transparent);
  
  /* Component-specific */
  --color-slider-track-dark: oklch(30% 0 0);
  
  /* Named color aliases for compatibility */
  --color-white: var(--base-neutral-0);
  --color-black: var(--base-neutral-900);
  
  /* ===== SPACING SCALE ===== */
  --space-3xs: 0.125rem;  /* 2px */
  --space-2xs: 0.375rem;  /* 6px */
  --space-xs: 0.25rem;    /* 4px */
  --space-sm: 0.5rem;     /* 8px */
  --space-md: 1rem;       /* 16px */
  --space-lg: 1.5rem;     /* 24px */
  --space-xl: 2rem;       /* 32px */
  --space-2xl: 3rem;      /* 48px */
  --space-3xl: 4rem;      /* 64px */
  
  /* Micro spacing for precise UI adjustments */
  --space-micro-1: 2px;
  --space-micro-2: 4px;
  --space-micro-3: 6px;
  --space-micro-4: 8px;
  --space-micro-5: 10px;
  --space-micro-6: 12px;
  
  /* ===== TYPOGRAPHY ===== */
  --font-size-xs: 0.75rem;
  --font-size-sm: 0.875rem;
  --font-size-base: 1rem;
  --font-size-lg: 1.125rem;
  --font-size-xl: 1.25rem;
  --font-size-2xl: 1.5rem;
  --font-size-3xl: 2rem;
  
  --line-height-tight: 1.25;
  --line-height-base: 1.6;
  --line-height-relaxed: 1.8;
  
  /* ===== BORDERS & RADIUS ===== */
  --border-width-thin: 1px;
  --border-width-base: 2px;
  --border-width-thick: 3px;
  --border-width-heavy: 4px;
  --border-width-extra: 5px;
  
  --radius-xs: 3px;
  --radius-sm: 4px;
  --radius-md: 6px;
  --radius-lg: 8px;
  --radius-xl: 12px;
  --radius-2xl: 16px;
  --radius-full: 9999px;
  
  /* ===== SHADOWS ===== */
  --shadow-sm: 0 1px 2px 0 color-mix(in oklch, var(--base-neutral-900) 5%, transparent);
  --shadow-md: 0 4px 6px -1px color-mix(in oklch, var(--base-neutral-900) 10%, transparent);
  --shadow-lg: 0 10px 15px -3px color-mix(in oklch, var(--base-neutral-900) 10%, transparent);
  --shadow-xl: 0 20px 25px -5px color-mix(in oklch, var(--base-neutral-900) 10%, transparent);
  
  /* Component-specific shadows */
  --shadow-button: 0 2px 4px color-mix(in oklch, var(--base-neutral-900) 30%, transparent);
  --shadow-button-hover: 0 4px 8px color-mix(in oklch, var(--base-neutral-900) 40%, transparent);
  
  /* ===== TRANSITIONS ===== */
  --transition-fast: 150ms ease;
  --transition-base: 200ms ease;
  --transition-slow: 300ms ease;
  
  /* ===== Z-INDEX SCALE ===== */
  --z-base: 0;
  --z-dropdown: 100;
  --z-sticky: 200;
  --z-overlay: 300;
  --z-modal: 400;
  --z-tooltip: 500;
  
  /* ===== COMPONENT SIZES ===== */
  --size-input-sm: 100px;
  --size-input-base: 120px;
  --size-input-compact: 60px;
  --size-input-md: 160px;
  --size-input-lg: 200px;
  --size-button-icon: 16px;
  --size-thumb: 15px;
  --size-slider-track: 4px;
  --size-scrollbar: 8px;
  --size-tooltip-min: 200px;
  --size-tooltip-max: 500px;
  --size-spinner: 14px;
  --size-nav-button: 24px;
  --line-height-nav-button: 20px;
  
  /* ===== LAYOUT ===== */
  --width-content-base: 1200px;
  --width-content-wide: 1440px;
  --width-grid-min: 250px;
  --width-grid-min-sm: 150px;
  --width-card-min: 350px;
  
  --height-input-min: 60px;
  --height-card-sm: 200px;
  --height-card-base: 300px;
  --height-demo-min: 300px;
  
  --gap-xs: 10px;
  --gap-sm: 15px;
  --gap-base: 20px;
  --gap-lg: 30px;
  --gap-xl: 40px;
  --gap-2xl: 50px;
  
  /* ===== BREAKPOINTS ===== */
  /* IMPORTANT: CSS custom properties do NOT work in @media queries!
     These values must be hardcoded in all @media rules throughout the codebase.
     They are defined here for documentation purposes only.
     If you change these values, you must manually update all @media queries. */
  --breakpoint-phone: 640px;
  --breakpoint-tablet: 768px;
  --breakpoint-desktop: 1024px;
  --breakpoint-wide: 1440px;
  
  /* Container query breakpoints */
  --container-sm: 600px;
  --container-md: 900px;
  --container-lg: 1200px;
  
  /* ===== TRANSFORMS ===== */
  --translate-subtle: -1px;
  --translate-sm: -2px;
  --translate-base: 1rem;
  
  --outline-offset-sm: 2px;
  --outline-offset-base: 3px;
}

/* ===== DARK THEME ===== */
@media (prefers-color-scheme: dark) {
  :root {
    /* Redefine base neutrals for dark mode */
    --base-neutral-0: oklch(15% 0.02 240);
    --base-neutral-100: oklch(18% 0.02 240);
    --base-neutral-200: oklch(22% 0.02 240);
    --base-neutral-300: oklch(30% 0.01 210);
    --base-neutral-700: oklch(65% 0.02 210);
    --base-neutral-800: oklch(85% 0.01 210);
    --base-neutral-900: oklch(100% 0 0);
    
    /* Adjust brand colors for dark mode */
    --base-primary: oklch(73% 0.15 220);
    --base-error: oklch(67% 0.24 25);
    
    /* Background colors automatically update via base neutrals */
    --color-bg: var(--base-neutral-0);
    --color-bg-secondary: var(--base-neutral-0);
    --color-card-bg: var(--base-neutral-200);
    --color-code-bg: var(--base-neutral-100);
    
    /* Text colors automatically update */
    --color-text: var(--base-neutral-800);
    --color-text-secondary: var(--base-neutral-700);
    --color-heading: oklch(96% 0.01 210);
    
    /* Interactive elements */
    --color-link-hover: oklch(68% 0.17 220);
    --color-button-bg: oklch(28% 0.02 240);
    --color-button-hover: oklch(34% 0.02 240);
    --color-button-text: var(--base-neutral-900);
    
    /* Borders */
    --color-border-light: oklch(26% 0.01 240);
    
    /* State colors */
    --color-error-bg: oklch(25% 0.10 25);
    --color-error-text-dark: oklch(90% 0.09 25);
    --color-info-bg: oklch(20% 0.05 220);
    
    /* Overlays - now using white instead of black */
    --color-overlay-light: color-mix(in oklch, var(--base-neutral-900) 2%, transparent);
    --color-overlay-medium: color-mix(in oklch, var(--base-neutral-900) 5%, transparent);
    --color-overlay-dark: color-mix(in oklch, var(--base-neutral-900) 10%, transparent);
    --color-spinner-border: color-mix(in oklch, var(--base-neutral-900) 10%, transparent);
    
    /* Tooltip colors */
    --color-tooltip-bg: var(--base-neutral-100);
    --color-tooltip-footer-bg: var(--base-neutral-0);
    
    /* Math colors - slightly brighter for dark mode */
    --color-definition: oklch(65% 0.13 252);
    --color-theorem: oklch(68% 0.15 142);
    --color-lemma: oklch(66% 0.14 241);
    --color-proposition: oklch(70% 0.12 230);
    --color-corollary: oklch(62% 0.08 250);
    --color-proof: oklch(55% 0.05 250);
    --color-example: oklch(63% 0.13 150);
    --color-remark: oklch(60% 0.06 250);
    --color-note: oklch(60% 0.06 250);
    --color-intuition: oklch(72% 0.12 180);
    --color-exercise: oklch(65% 0.13 252);
    --color-solution: oklch(60% 0.06 250);
    
    /* Math tooltip type colors for dark mode */
    --color-type-definition: var(--base-primary);
    --color-type-theorem: var(--base-error);
    --color-type-proposition: oklch(75% 0.15 300);
    --color-type-lemma: oklch(72% 0.17 40);
    --color-type-corollary: oklch(65% 0.12 142);
    --color-type-example: oklch(70% 0.10 85);
    --color-type-note: oklch(65% 0.04 250);
    
    /* Nested overlays - increased opacity for dark mode */
    --color-nested-definition: color-mix(in oklch, var(--color-definition) 6%, transparent);
    --color-nested-theorem: color-mix(in oklch, var(--color-theorem) 6%, transparent);
    --color-nested-lemma: color-mix(in oklch, var(--color-lemma) 6%, transparent);
    --color-nested-proposition: color-mix(in oklch, var(--color-proposition) 6%, transparent);
    --color-nested-corollary: color-mix(in oklch, var(--color-corollary) 5%, transparent);
    --color-nested-proof: color-mix(in oklch, var(--color-proof) 6%, transparent);
    --color-nested-example: color-mix(in oklch, var(--color-example) 6%, transparent);
    
    /* Embedded block overlays */
    --color-embedded-bg: color-mix(in oklch, var(--base-neutral-900) 3%, transparent);
    
    /* Darker shadows for dark mode */
    --shadow-sm: 0 1px 2px 0 color-mix(in oklch, var(--base-neutral-900) 20%, transparent);
    --shadow-md: 0 4px 6px -1px color-mix(in oklch, var(--base-neutral-900) 30%, transparent);
    --shadow-lg: 0 10px 15px -3px color-mix(in oklch, var(--base-neutral-900) 40%, transparent);
    --shadow-xl: 0 20px 25px -5px color-mix(in oklch, var(--base-neutral-900) 50%, transparent);
  }
}

/* ===== UTILITY CLASSES ===== */
.theme-primary { color: var(--color-primary); }
.theme-bg-primary { background-color: var(--color-primary); }
.theme-border-primary { border-color: var(--color-primary); }