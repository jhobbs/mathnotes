{% extends "base.html" %}

{% block title %}{{ title }} - {{ config.SITE_TITLE }}{% endblock %}

{% block description %}{{ page_description or config.SITE_DESCRIPTION }}{% endblock %}

{% block header_link %}{{ url_for('mathnotes_index') }}{% endblock %}

{% block body_class %}has-sidebar{% endblock %}

{% block header_extra %}
<nav class="page-nav-arrows">
    {% if navigation.prev_page %}
    <a href="{{ navigation.prev_page.url }}" class="nav-prev" title="{{ navigation.prev_page.title }}">
        <span class="nav-arrow">&larr;</span>
        <span class="nav-label">{{ navigation.prev_page.title }}</span>
    </a>
    {% else %}
    <span class="nav-prev disabled"></span>
    {% endif %}
    {% if navigation.next_page %}
    <a href="{{ navigation.next_page.url }}" class="nav-next" title="{{ navigation.next_page.title }}">
        <span class="nav-label">{{ navigation.next_page.title }}</span>
        <span class="nav-arrow">&rarr;</span>
    </a>
    {% else %}
    <span class="nav-next disabled"></span>
    {% endif %}
</nav>
{% endblock %}

{% macro render_tree(items) %}
<ul class="nav-tree">
    {% for item in items %}
    <li class="nav-item nav-{{ item.type }}{% if item.is_current %} current{% endif %}{% if item.expanded %} expanded{% endif %}">
        {% if item.type == "page" %}
        <a href="{{ item.url }}">{{ item.title }}</a>
        {% else %}
        <span class="folder-toggle">
            <span class="folder-icon">{% if item.expanded %}&#9660;{% else %}&#9654;{% endif %}</span>
            {{ item.name }}
        </span>
        {% if item.children %}
        <div class="folder-children{% if not item.expanded %} collapsed{% endif %}">
            {{ render_tree(item.children) }}
        </div>
        {% endif %}
        {% endif %}
    </li>
    {% endfor %}
</ul>
{% endmacro %}

{% block content %}
<div class="page-layout">
    <aside class="page-sidebar" id="page-sidebar">
        <nav class="sidebar-nav">
            <div class="sidebar-parent">
                <a href="/mathnotes/">&larr; Main</a>
            </div>

            <div class="sidebar-tree">
                {{ render_tree(navigation.tree.children) }}
            </div>
        </nav>
    </aside>

    <article class="page-content">
        {{ content|safe }}
    </article>

    {% if sources %}
    <footer class="sources-section">
        <button class="sources-toggle" data-sources="toggle" type="button">
            <span class="sources-icon">&#9654;</span>
            <span class="sources-label">Sources ({{ sources|length }})</span>
        </button>
        <div class="sources-content">
            <ul class="sources-list">
                {% for source in sources %}
                <li class="source-item">
                    <div class="source-main">
                        {% if source.url %}
                        <a href="{{ source.url }}" class="source-title" target="_blank" rel="noopener">{{ source.title }}</a>
                        {% else %}
                        <span class="source-title">{{ source.title }}</span>
                        {% endif %}
                        {% if source.author %}
                        <span class="source-author">{{ source.author }}</span>
                        {% endif %}
                        {% if source.type %}
                        <span class="source-type">{{ source.type }}</span>
                        {% endif %}
                    </div>
                    {% if source.section or source.isbn or source.notes or source.accessed %}
                    <div class="source-meta">
                        {% if source.section %}<span class="source-section">{{ source.section }}</span>{% endif %}
                        {% if source.isbn %}<span class="source-isbn">ISBN: {{ source.isbn }}</span>{% endif %}
                        {% if source.accessed %}<span class="source-accessed">Accessed: {{ source.accessed }}</span>{% endif %}
                        {% if source.notes %}<span class="source-notes">{{ source.notes }}</span>{% endif %}
                    </div>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </div>
    </footer>
    {% endif %}
</div>
{% endblock %}

{% block footer %}
<p>&copy; {{ current_year }} Jason Hobbs. All rights reserved. | Version: <a href="https://github.com/jhobbs/mathnotes/blob/{{ app_version }}/{{ source_path }}" target="_blank" rel="noopener">{{ app_version }}</a></p>
{% endblock %}